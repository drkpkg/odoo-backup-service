#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_build:
	@if [ -f /root/.cargo/bin/cargo ]; then \
		/root/.cargo/bin/cargo build --release; \
	elif command -v cargo >/dev/null 2>&1; then \
		cargo build --release; \
	else \
		echo "Error: Cargo not found"; \
		exit 1; \
	fi

override_dh_auto_install:
	# Create directories
	install -d -m 755 debian/odoo-backup-service/usr/bin
	install -d -m 755 debian/odoo-backup-service/etc/odoo-backup
	install -d -m 755 debian/odoo-backup-service/usr/share/doc/odoo-backup-service
	install -d -m 755 debian/odoo-backup-service/var/backups/odoo
	
	# Install binary with proper permissions
	install -m 755 target/release/odoo-backup-service debian/odoo-backup-service/usr/bin/odoo-backup
	# Install configuration file
	install -m 644 config.json.example debian/odoo-backup-service/etc/odoo-backup/config.json
	# Install documentation
	install -m 644 README.md debian/odoo-backup-service/usr/share/doc/odoo-backup-service/README.md
